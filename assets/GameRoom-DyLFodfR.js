import{j as e}from"./framer-CXIzzW3M.js";import{e as be,d as ye,r as i}from"./vendor-Nm6aTgQn.js";import{s as r}from"./socket-KrrjFy0R.js";import{L as Y}from"./index-CpAyggxO.js";const je=({players:g,hostId:f,selfId:t,gamePhase:L,partyCode:F,isHost:I})=>e.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-purple-400 mb-4",children:"Players"}),e.jsx("ul",{className:"space-y-3",children:g.map(u=>e.jsxs("li",{className:"flex justify-between items-center bg-gray-900/50 p-3 rounded-lg",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("span",{className:"font-semibold",children:[u.name,u.id===f&&" (Host) ðŸ‘‘",u.id===t&&" (You)"]})}),e.jsx("div",{className:"flex items-center",children:I&&L==="waiting"&&u.id!==f&&e.jsxs("span",{className:"relative inline-block group",children:[e.jsx("button",{onClick:()=>{console.log("Requesting kick for",u.id,"from host",r.id);try{r.emit("kick_player",{partyCode:F,playerId:u.id},N=>{console.log("kick_player ack:",N)})}catch(N){console.warn("kick emit failed",N)}},"aria-label":`Exclure ${u.name}`,className:"text-sm text-red-400 hover:text-red-300 bg-red-900/10 hover:bg-red-900/20 rounded px-2 py-1",children:"âœ–"}),e.jsx("div",{className:"absolute -top-9 right-0 hidden group-hover:block bg-gray-900 text-white text-sm py-1 px-2 rounded whitespace-nowrap border border-gray-700",children:"Exclure"})]})})]},u.id))})]});function Ce(){var ae,le,ne,oe;const{partyCode:g}=be(),f=ye(),[t,L]=i.useState(null),[F,I]=i.useState(!0),[u,N]=i.useState(null),[H,b]=i.useState("waiting"),[y,K]=i.useState(null),[U,O]=i.useState(0),[J,ie]=i.useState(0),[S,D]=i.useState(""),[T,A]=i.useState([]),[ce,X]=i.useState(null),[j,B]=i.useState(0),[q,$]=i.useState(0),[de,z]=i.useState(!1),[me,Z]=i.useState(!1),P=i.useRef(null),E=i.useRef(null),ee=i.useRef(0);i.useEffect(()=>{const d=s=>{var v,x,p,C,Q,R,_,a;if(s!=null&&s.code&&s.code!==g)try{f(`/games/${s.code}`,{replace:!0})}catch(m){console.warn("Failed to update URL on party code change",m)}L(s),I(!1),((v=s.game)==null?void 0:v.currentQuestion)>0&&((x=s.game.questions)==null?void 0:x.length)>0&&s.game.currentQuestion<s.game.questions.length?(b("playing"),O(s.game.currentQuestion)):((p=s.game)==null?void 0:p.currentQuestion)>=((C=s.game.questions)==null?void 0:C.length)&&((Q=s.game.questions)==null?void 0:Q.length)>0&&s.game.playerAnswers&&!s.game.playerAnswers.every(m=>m.validated)?(b("validation"),H!=="validation"&&(B(0),$(0))):((R=s.game)==null?void 0:R.currentQuestion)>=((_=s.game.questions)==null?void 0:_.length)&&((a=s.game.questions)==null?void 0:a.length)>0&&s.game.playerAnswers&&s.game.playerAnswers.every(m=>m.validated)&&b("results")},c=()=>{N("Party not found."),I(!1),setTimeout(()=>f("/games"),3e3)},o=({question:s,questionIndex:v,timePerQuestion:x,startTime:p})=>{b("playing"),K(s),O(v||0),D(""),A([]),z(!1),E.current=p||Date.now(),ee.current=x,te(E.current,x)},h=({question:s,questionIndex:v,timePerQuestion:x,startTime:p})=>{b("playing"),K(s),O(v),D(""),A([]),z(!1),E.current=p||Date.now(),ee.current=x,te(E.current,x)},n=({validationRequired:s})=>{clearInterval(P.current),s?(b("validation"),B(0),$(0)):b("results")},M=({finalScores:s})=>{b("results"),X(s)},l=({reason:s})=>{N(s||"Party was closed by the host."),I(!1),setTimeout(()=>f("/games"),3e3)};return r.on("party_state",d),r.on("kicked",s=>{N((s==null?void 0:s.reason)||"You were removed from the party."),setTimeout(()=>f("/games"),1500)}),r.on("party_not_found",c),r.on("game_started",o),r.on("next_question",h),r.on("game_over",n),r.on("final_game_over",M),r.on("party_closed",l),r.emit("get_party_state",g),()=>{r.off("party_state",d),r.off("party_not_found",c),r.off("kicked"),r.off("game_started",o),r.off("next_question",h),r.off("game_over",n),r.off("final_game_over",M),r.off("party_closed",l),r.on("rematch_starting",()=>{b("waiting"),X(null)}),r.on("rematch_vote_received",s=>{}),r.on("trigger_rematch",({partyCode:s})=>{G&&r.emit("start_game",{partyCode:s,isRematch:!0})}),clearInterval(P.current)}},[g,f]);const xe=async()=>{var c;if(!(!t||!(((c=t.players[0])==null?void 0:c.id)===r.id)))try{r.emit("reset_party_code",{partyCode:t.code},o=>{o&&o.ok?console.log("Party code reset to",o.newCode):console.warn("Could not reset party code",o)})}catch(o){console.error("reset emit failed",o)}},te=(d,c)=>{clearInterval(P.current);const o=()=>{const h=Math.floor((Date.now()-(d||Date.now()))/1e3),n=Math.max(0,c-h);ie(n),n<=0&&(clearInterval(P.current),k(!0))};o(),P.current=setInterval(o,1e3)},k=(d=!1)=>{if(!y)return;let c=S;(y.type==="multiple-choice"||y.type==="multiple-answer")&&(c=T),!d&&(y.type==="text"&&!S.trim()||(y.type==="multiple-choice"||y.type==="multiple-answer")&&T.length),!de&&(r.emit("submit_answer",{partyCode:g,questionIndex:U,answer:c}),z(!0))},se=d=>{if(!t||!t.game||!t.game.questions||!t.players)return;const c=t.players[q];c&&r.emit("submit_validation",{partyCode:g,validatedPlayerId:c.id,validatedQuestionIndex:j,isCorrect:d})},ge=()=>{var h;if(!t||!t.game||!t.players||!t.game.questions)return;const d=t.players.length,c=t.game.questions.length,o=(h=t.game.playerAnswers)==null?void 0:h.find(n=>n.playerId===t.players[q].id&&n.questionIndex===j);if(!o||!o.validated){alert("Please validate the current answer before moving on.");return}q<d-1?$(n=>n+1):j<c-1&&(B(n=>n+1),$(0))};if(F)return e.jsx(Y,{});if(u)return e.jsxs("div",{className:"text-white min-h-screen bg-gray-900 p-8 flex flex-col items-center justify-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-red-500 mb-4",children:"Error"}),e.jsxs("p",{className:"text-xl",children:[u," Redirecting you to the lobby..."]})]});if(!t)return null;const re=r.id,G=((ae=t.players[0])==null?void 0:ae.id)===re,ue=()=>{var d;switch(H){case"waiting":return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Waiting Room"}),e.jsx("p",{className:"text-gray-400 mb-8",children:"The game will begin shortly."}),G?e.jsx("button",{onClick:he,className:"bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-lg text-xl transition-transform hover:scale-105",children:"Start Game"}):e.jsx("p",{className:"text-cyan-400",children:"Waiting for the host to start the game..."})]});case"playing":if(!y)return e.jsx(Y,{});const{question:c,options:o,type:h}=y;return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("p",{className:"text-gray-400 text-lg mb-2",children:["Question ",U+1," / ",t.game.questions.length]}),e.jsx("h2",{className:"text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-300 to-cyan-300 mb-4",children:c}),e.jsxs("div",{className:`text-5xl font-extrabold ${J<=5?"text-red-500 animate-pulse":"text-green-400"}`,children:[J,"s"]})]}),e.jsxs("div",{className:"flex-grow flex flex-col justify-center items-center",children:[h==="text"&&e.jsx("input",{type:"text",value:S,onChange:a=>D(a.target.value),onBlur:()=>k(!1),onKeyDown:a=>{a.key==="Enter"&&k(!1)},placeholder:"Type your answer here...",className:"w-full max-w-md bg-gray-800 text-white border border-gray-700 rounded-lg py-3 px-4 text-lg focus:outline-none focus:ring-2 focus:ring-purple-500"}),h==="multiple-choice"&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-md",children:o.map((a,m)=>e.jsxs("label",{className:"flex items-center bg-gray-800 hover:bg-gray-700 rounded-lg p-4 cursor-pointer transition-colors",children:[e.jsx("input",{type:"radio",name:"answer",value:a,checked:T[0]===a,onChange:()=>{A([a]),setTimeout(()=>k(!1),0)},className:"form-radio h-5 w-5 text-purple-600 bg-gray-700 border-gray-600 focus:ring-purple-500"}),e.jsx("span",{className:"ml-3 text-lg",children:a})]},m))}),h==="multiple-answer"&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-md",children:o.map((a,m)=>e.jsxs("label",{className:"flex items-center bg-gray-800 hover:bg-gray-700 rounded-lg p-4 cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:T.includes(a),onChange:W=>{W.target.checked?A(V=>{const w=[...V,a];return setTimeout(()=>k(!1),0),w}):A(V=>{const w=V.filter(fe=>fe!==a);return setTimeout(()=>k(!1),0),w})},className:"form-checkbox h-5 w-5 text-purple-600 bg-gray-700 border-gray-600 focus:ring-purple-500"}),e.jsx("span",{className:"ml-3 text-lg",children:a})]},m))})]})]});case"validation":if(!t.game.questions||!t.players||!t.game.playerAnswers)return e.jsx(Y,{});const n=t.game.questions[j],l=t.game.playerAnswers.filter(a=>a.questionIndex===j).sort((a,m)=>{const W=t.players.findIndex(w=>w.id===a.playerId),V=t.players.findIndex(w=>w.id===m.playerId);return W-V})[q],s=t.players.find(a=>a.id===(l==null?void 0:l.playerId));return!n||!s||!l?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4 text-red-500",children:"Validation Error"}),e.jsx("p",{className:"text-gray-400",children:"No answers to validate or data is inconsistent."})]}):G?e.jsxs("div",{className:"flex flex-col h-full items-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-purple-400 mb-4",children:"Validate Answers"}),e.jsxs("p",{className:"text-gray-400 text-lg mb-2",children:["Question ",j+1," / ",t.game.questions.length]}),e.jsx("h3",{className:"text-2xl font-semibold mb-2",children:n.question}),e.jsxs("p",{className:"text-sm text-gray-400 mb-6",children:["Correct answer: ",e.jsx("span",{className:"font-semibold text-cyan-300",children:Array.isArray(n.answer)?n.answer.join(", "):n.answer})]}),e.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg w-full max-w-xl text-center",children:[e.jsxs("p",{className:"text-xl font-bold mb-2",children:[s.name,"'s Answer:"]}),e.jsx("p",{className:"text-cyan-300 text-2xl mb-6 break-words",children:Array.isArray(l.answer)?l.answer.join(", "):l.answer||"No Answer"}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{onClick:()=>se(!0),className:`bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg text-lg transition-transform hover:scale-105 ${l.validated&&l.isCorrect?"ring-2 ring-green-400":""}`,children:"Correct"}),e.jsx("button",{onClick:()=>se(!1),className:`bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg text-lg transition-transform hover:scale-105 ${l.validated&&!l.isCorrect?"ring-2 ring-red-400":""}`,children:"Incorrect"})]})]}),e.jsx("div",{className:"mt-8",children:e.jsx("button",{onClick:ge,className:"bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-lg text-xl transition-transform hover:scale-105",children:j===t.game.questions.length-1&&q===t.players.length-1?"Finish Validation":"Next"})})]}):e.jsxs("div",{className:"flex flex-col h-full items-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-purple-400 mb-4",children:"Validation"}),e.jsxs("p",{className:"text-gray-400 text-lg mb-2",children:["Question ",j+1," / ",t.game.questions.length]}),e.jsx("h3",{className:"text-2xl font-semibold mb-2",children:n.question}),e.jsxs("p",{className:"text-sm text-gray-400 mb-4",children:["Correct answer: ",e.jsx("span",{className:"font-semibold text-cyan-300",children:Array.isArray(n.answer)?n.answer.join(", "):n.answer})]}),e.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg w-full max-w-xl text-center",children:[e.jsxs("p",{className:"text-xl font-bold mb-2",children:[s.name,"'s Answer:"]}),e.jsx("p",{className:`text-2xl mb-6 break-words ${l.validated?l.isCorrect?"text-green-300":"text-red-300":"text-cyan-300"}`,children:Array.isArray(l.answer)?l.answer.join(", "):l.answer||"No Answer"}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("div",{className:`py-3 px-6 rounded-lg text-lg ${l.validated&&l.isCorrect?"bg-green-600 ring-2 ring-green-400 text-white":"bg-gray-700 text-white/80"}`,children:"Correct"}),e.jsx("div",{className:`py-3 px-6 rounded-lg text-lg ${l.validated&&!l.isCorrect?"bg-red-600 ring-2 ring-red-400 text-white":"bg-gray-700 text-white/80"}`,children:"Incorrect"})]})]})]});case"results":const v=(ce||t.players.map(a=>({name:a.name,score:a.score}))).sort((a,m)=>m.score-a.score),[x,p,C,...Q]=v,R=((d=t.game)==null?void 0:d.rematchVotes)||[],_=R.includes(r.id);return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx("h2",{className:"text-4xl font-bold mb-8 text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-cyan-400",children:"Game Over!"}),e.jsx("div",{className:"w-full max-w-2xl mb-12",children:e.jsxs("div",{className:"flex items-end justify-center gap-4 mb-8",children:[p&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-400 to-gray-600 rounded-t-lg p-4 w-24 text-center mb-2",children:[e.jsx("p",{className:"text-2xl",children:"ðŸ¥ˆ"}),e.jsx("p",{className:"text-sm font-bold",children:p.name}),e.jsxs("p",{className:"text-lg font-bold text-white",children:[p.score," pts"]})]}),e.jsx("div",{className:"bg-gray-700 h-20 w-24 flex items-center justify-center font-bold text-2xl",children:"2"})]}),x&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-t-lg p-4 w-24 text-center mb-2 ring-2 ring-yellow-400",children:[e.jsx("p",{className:"text-2xl",children:"ðŸ¥‡"}),e.jsx("p",{className:"text-sm font-bold text-black",children:x.name}),e.jsxs("p",{className:"text-lg font-bold text-black",children:[x.score," pts"]})]}),e.jsx("div",{className:"bg-gray-700 h-24 w-24 flex items-center justify-center font-bold text-3xl",children:"1"})]}),C&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"bg-gradient-to-br from-orange-400 to-orange-600 rounded-t-lg p-4 w-24 text-center mb-2",children:[e.jsx("p",{className:"text-2xl",children:"ðŸ¥‰"}),e.jsx("p",{className:"text-sm font-bold",children:C.name}),e.jsxs("p",{className:"text-lg font-bold text-white",children:[C.score," pts"]})]}),e.jsx("div",{className:"bg-gray-700 h-16 w-24 flex items-center justify-center font-bold text-xl",children:"3"})]})]})}),Q.length>0&&e.jsxs("div",{className:"w-full max-w-md mb-8",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-3 text-center",children:"Other Players"}),e.jsx("ul",{className:"space-y-2",children:Q.map((a,m)=>e.jsxs("li",{className:"flex justify-between items-center bg-gray-900/50 p-2 rounded-lg",children:[e.jsx("span",{className:"font-semibold text-sm",children:a.name}),e.jsxs("span",{className:"font-mono text-cyan-400 text-sm",children:[a.score," pts"]})]},m))})]}),e.jsxs("div",{className:"flex gap-4 mt-8",children:[e.jsx("button",{onClick:()=>r.emit("submit_rematch_vote",{partyCode:g}),disabled:_,className:`font-bold py-3 px-8 rounded-lg text-lg transition-colors ${_?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"}`,children:_?`Rematch (${R.length}/${t.players.length})`:"Play Again"}),e.jsx("button",{onClick:()=>f("/games"),className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition-colors",children:"Back to Lobby"})]})]});default:return null}},he=()=>{r.emit("start_game",{partyCode:g})},pe=async()=>{try{await navigator.clipboard.writeText(g||(t==null?void 0:t.code)||""),Z(!0),setTimeout(()=>Z(!1),2e3)}catch(d){console.error("Copy failed",d)}};return e.jsxs("div",{className:"relative w-full overflow-x-hidden bg-[#0a0a0f] text-white min-h-screen p-4 sm:p-8",children:[e.jsxs("div",{className:"fixed inset-0 pointer-events-none",children:[e.jsx("div",{className:"bg-shape-top-left absolute top-0 left-0 w-1/2 h-1/2 bg-purple-900/20 blur-[150px]"}),e.jsx("div",{className:"bg-shape-bottom-right absolute bottom-0 right-0 w-1/2 h-1/2 bg-cyan-900/20 blur-[150px]"})]}),e.jsxs("header",{className:"relative z-10 text-center mb-8",children:[e.jsx("p",{className:"text-gray-400 mb-2",children:"Party Code"}),e.jsx("div",{className:"inline-block relative",children:e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsxs("span",{className:"relative inline-block group",children:[e.jsx("button",{onClick:pe,className:"text-4xl font-bold font-mono tracking-widest bg-gray-800/50 hover:bg-gray-700/50 inline-block px-4 py-2 rounded-lg border border-gray-700 transition-colors cursor-pointer",children:t.code}),e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block bg-gray-900 text-white text-sm py-1 px-3 rounded whitespace-nowrap border border-gray-700",children:me?"Copied!":"Copy"})]}),((ne=(le=t.players)==null?void 0:le[0])==null?void 0:ne.id)===r.id&&e.jsxs("span",{className:"relative inline-block group",children:[e.jsx("button",{onClick:()=>{console.log("resetPartyCode clicked by",r.id),xe()},"aria-label":"Reset party code",className:"ml-2 p-1 rounded-full bg-transparent hover:bg-white/10 text-white border border-white/10",style:{width:28,height:28,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:e.jsx("path",{d:"M12 6V3L8 7l4 4V8a4 4 0 1 1-4 4H6a6 6 0 1 0 6-6z",fill:"currentColor"})})}),e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block bg-gray-900 text-white text-sm py-1 px-3 rounded whitespace-nowrap border border-gray-700",children:"Reset"})]})]})})]}),e.jsxs("main",{className:"relative z-10 max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-lg p-8 min-h-[400px] flex flex-col justify-between",children:ue()})}),e.jsx("aside",{children:e.jsx(je,{players:t.players,hostId:(oe=t.players[0])==null?void 0:oe.id,selfId:re,gamePhase:H,partyCode:g,isHost:G})})]})]})}export{Ce as default};
