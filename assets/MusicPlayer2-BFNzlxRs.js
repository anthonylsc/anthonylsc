import{j as t}from"./framer-CXIzzW3M.js";import{r as o}from"./vendor-Nm6aTgQn.js";window.__audioInstances||(window.__audioInstances=new Set);const X=()=>{window.__audioInstances.forEach(_=>{try{_.pause(),_.currentTime=0}catch{}}),window.__audioInstances.clear()},re=o.forwardRef(function({src:b,startAt:x=253,autoPlay:Y=!1,playKey:Z=null,title:E="Musique",visible:P=!0},I){const r=o.useRef(null),[M,w]=o.useState(!1),[g,q]=o.useState(.5),[y,N]=o.useState(!1),[$,k]=o.useState(!1),z="/",[B,F]=o.useState(b??z+"music.mp3"),j=B,L=o.useRef(!1),d=o.useRef(null),R=o.useRef(b??z+"music.mp3"),S=o.useRef(null);o.useEffect(()=>{if(L.current){L.current=!1;return}try{const e=new Audio(j);if(e.loop=!0,e.preload="auto",e.volume=g,e.muted=y,r.current=e,window.__audioVisualizer&&!window.__audioVisualizer.isConnected)try{const c=new(window.AudioContext||window.webkitAudioContext),l=c.createAnalyser();l.fftSize=256,l.smoothingTimeConstant=.8,c.createMediaElementAudioSource(e).connect(l),l.connect(c.destination),window.__audioVisualizer.analyser=l,window.__audioVisualizer.dataArray=new Uint8Array(l.frequencyBinCount),window.__audioVisualizer.isConnected=!0,c.state==="suspended"&&c.resume()}catch{}const n=()=>{try{x!=null&&typeof e.duration=="number"&&x<e.duration&&(e.currentTime=x)}catch{}};e.readyState>=1?n():e.addEventListener("loadedmetadata",n,{once:!0});const s=()=>v(e.currentTime||0),u=()=>T(e.duration||0);e.addEventListener("timeupdate",s),e.addEventListener("loadedmetadata",u),e.addEventListener("durationchange",u),d.current={onTime:s,onMeta:u},window.__audioInstances.add(e);const a=()=>{try{e.pause(),e.currentTime=0,j===R.current&&e.play().catch(()=>{})}catch{}};return e.addEventListener("ended",a),d.current.onEnded=a,()=>{try{if(d.current&&e){try{e.removeEventListener("timeupdate",d.current.onTime)}catch{}try{e.removeEventListener("loadedmetadata",d.current.onMeta)}catch{}try{e.removeEventListener("durationchange",d.current.onMeta)}catch{}try{e.removeEventListener("ended",d.current.onEnded)}catch{}}}catch{}try{e.pause(),e.src=""}catch{}r.current=null,d.current=null,window.__audioInstances.delete(e)}}catch(e){console.error("MusicPlayer init failed",e)}},[j,x]);const[p,v]=o.useState(0),[m,T]=o.useState(0),[D,H]=o.useState(0),[A,U]=o.useState(0),h=o.useRef(null);o.useEffect(()=>{const e=r.current;if(!e)return;const n=()=>v(e.currentTime||0),s=()=>T(e.duration||0);return e.addEventListener("timeupdate",n),e.addEventListener("loadedmetadata",s),e.addEventListener("durationchange",s),()=>{try{e.removeEventListener("timeupdate",n)}catch{}try{e.removeEventListener("loadedmetadata",s)}catch{}try{e.removeEventListener("durationchange",s)}catch{}}},[r.current]),o.useEffect(()=>{h.current&&cancelAnimationFrame(h.current);const e=m?Math.min(100,Math.max(0,p/m*100)):0,n=()=>{H(s=>{const u=p-s;return Math.abs(u)>.5?p:s+u*.15}),U(s=>{const u=e-s;return Math.abs(u)>2?e:s+u*.15}),h.current=requestAnimationFrame(n)};return h.current=requestAnimationFrame(n),()=>{h.current&&cancelAnimationFrame(h.current)}},[p,m]);const K=async()=>{const e=r.current;if(e)if(M){try{e.pause()}catch{}w(!1)}else try{await e.play(),w(!0)}catch(n){console.error("Play failed",n)}},W=e=>{const n=Number(e.target.value);q(n),r.current&&(r.current.volume=n)},G=()=>{const e=r.current;if(!e)return;const n=!e.muted;try{e.muted=n}catch{}N(n)},J=e=>{const n=Number(e.target.value);if(r.current&&!Number.isNaN(n)){try{r.current.currentTime=n}catch{}v(n)}},V=e=>{if(!e)return"0:00";const n=Math.floor(e/60),s=Math.floor(e%60).toString().padStart(2,"0");return`${n}:${s}`},O=Math.min(100,Math.max(0,y?0:g*100)),Q=E&&E!=="Musique"?`Musique - ${E}`:"Musique";return o.useImperativeHandle(I,()=>({stop:()=>{try{r.current&&(r.current.pause(),r.current.currentTime=0),w(!1),v(0)}catch(e){console.warn("Stop failed",e)}},play:async(e,n=null,s=0)=>{var u;try{S.current=((u=r.current)==null?void 0:u.src)||R.current,X();try{if(r.current){try{r.current.pause(),r.current.currentTime=0,r.current.src=""}catch{}try{if(d.current){try{r.current.removeEventListener("timeupdate",d.current.onTime)}catch{}try{r.current.removeEventListener("loadedmetadata",d.current.onMeta)}catch{}try{r.current.removeEventListener("durationchange",d.current.onMeta)}catch{}}}catch{}}}catch{}const a=new Audio(e);a.loop=!0,a.preload="auto",a.volume=g,a.muted=y;try{a.currentTime=s}catch{}if(window.__audioVisualizer)try{const i=new(window.AudioContext||window.webkitAudioContext),f=i.createAnalyser();f.fftSize=256,f.smoothingTimeConstant=.8,i.createMediaElementAudioSource(a).connect(f),f.connect(i.destination),window.__audioVisualizer.analyser=f,window.__audioVisualizer.dataArray=new Uint8Array(f.frequencyBinCount),window.__audioVisualizer.isConnected=!0,i.state==="suspended"&&i.resume()}catch{}window.__audioInstances.add(a);const c=()=>v(a.currentTime||0),l=()=>T(a.duration||0);a.addEventListener("timeupdate",c),a.addEventListener("loadedmetadata",l),a.addEventListener("durationchange",l);const C=()=>{try{if(S.current){const i=new Audio(S.current);i.volume=a.volume,i.muted=a.muted,window.__audioInstances.add(i),i.play().catch(()=>{})}}catch{}};a.addEventListener("ended",C),d.current={onTime:c,onMeta:l,onEnded:C},r.current=a,L.current=!0,F(e);try{await a.play(),w(!0)}catch(i){console.warn("Play failed (imperative)",i),w(!1)}}catch(a){console.error("Player play error",a)}}})),t.jsx("div",{className:`fixed left-1/2 transform -translate-x-1/2 bottom-6 z-50 w-[92%] max-w-3xl transition-all duration-300 ${P?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,children:t.jsxs("div",{className:"music-card flex items-center gap-4 px-4 py-3 rounded-3xl bg-gradient-to-r from-white/6 to-white/4 backdrop-blur-xl border border-white/10 shadow-lg text-white relative transition-all duration-300 hover:border-white/20",children:[t.jsx("button",{onClick:K,className:"player-play-btn w-14 h-14 rounded-full flex items-center justify-center text-2xl bg-gradient-to-br from-purple-600 to-violet-500 shadow-md",children:M?t.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[t.jsx("rect",{x:"5",y:"4",width:"4",height:"16",fill:"white",rx:"1"}),t.jsx("rect",{x:"15",y:"4",width:"4",height:"16",fill:"white",rx:"1"})]}):t.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:t.jsx("path",{d:"M5 3v18l15-9L5 3z",fill:"white"})})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"truncate",children:[t.jsx("div",{className:"text-sm font-semibold transition-all duration-300",children:Q}),t.jsx("div",{className:"text-xs text-gray-300 transition-all duration-300",children:M?"En cours":"En pause"})]}),t.jsxs("div",{className:"text-xs text-gray-300 transition-all duration-300 tabular-nums",children:[V(D)," / ",V(m)]})]}),t.jsx("input",{type:"range",min:0,max:m||0,step:.1,value:A>0?A/100*m:p,onChange:J,className:"player-range",style:{background:"linear-gradient(90deg, rgba(147,51,234,0.95) 0%, rgba(99,102,241,0.95) 100%)",backgroundSize:`${A}% 100%`,backgroundRepeat:"no-repeat"}})]}),t.jsx("div",{className:"relative flex-shrink-0",onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),children:t.jsxs("div",{className:"relative flex items-center",children:[t.jsx("button",{onClick:G,className:"w-10 h-10 rounded-full flex items-center justify-center bg-white/3 hover:bg-white/5 transition-colors z-20",children:y?t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[t.jsx("path",{d:"M16 7v10a1 1 0 0 1-1.6.8L11 15H8a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1h3l3.4-3.8A1 1 0 0 1 16 7z",fill:"white"}),t.jsx("path",{d:"M19 5l-2 2m0 10 2 2",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}):t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:t.jsx("path",{d:"M5 9v6h4l5 4V5L9 9H5z",fill:"white"})})}),t.jsx("div",{className:`absolute top-1/2 left-full ml-3 transform -translate-y-1/2 w-40 transition-all duration-300 ${$?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,children:t.jsx("input",{type:"range",min:0,max:1,step:.01,value:y?0:g,onChange:e=>{W(e),N(!1)},className:"player-range-mini",style:{background:"linear-gradient(90deg, rgba(147,51,234,0.95) 0%, rgba(99,102,241,0.95) 100%)",backgroundSize:`${O}% 100%`,backgroundRepeat:"no-repeat"}})})]})})]})})});export{re as default};
